rules:
  - id: CWE256_Plaintext_Storage_of_Password__w32_char_01
    message: "Potential plaintext storage of password (CWE-256). Consider decrypting the password before using it."
    severity: ERROR
    metadata:
      cwe: "CWE-256"
    languages: [c]
    patterns:
      - pattern: |
          if (LogonUserA($USERNAME, $DOMAIN, $PASSWORD, LOGON32_LOGON_NETWORK, LOGON32_PROVIDER_DEFAULT, &$PHANDLE) != 0) {
            ...
          } else {
            ...
          }
      - pattern-not: |
          do {
            ...
            if(!CryptDecrypt($KEY, 0, 1, 0, $DECRYPTED_PAYLOAD, &$DECRYPTED_PAYLOAD_BYTES)) {
              break;
            }
            ...
          } while (0);