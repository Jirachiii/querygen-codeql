rules:
  - id: CWE256_Plaintext_Storage_of_Password__w32_char_02
    message: "Potential CWE-256: Plaintext Storage of Password detected."
    severity: ERROR
    metadata:
      cwe: "CWE-256"
    languages: [c]
    patterns:
      - pattern: |
          if (LogonUserA(
                  $USERNAME,
                  $DOMAIN,
                  $DATA,
                  LOGON32_LOGON_NETWORK,
                  LOGON32_PROVIDER_DEFAULT,
                  &$PHANDLE) != 0) {
            ...
          }
      - pattern-not: |
          do {
              ...
              if (!CryptDecrypt(
                        hKey,
                        0,
                        1,
                        0,
                        payload,
                        &payloadBytes)) {
                  break;
              }
              /* Copy back into data and NUL-terminate */
              memcpy(data, payload, payloadBytes);
              data[payloadBytes / sizeof(char)] = '\0';
              ...
          } while(0);